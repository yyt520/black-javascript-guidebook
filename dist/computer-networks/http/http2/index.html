<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link
      rel="stylesheet"
      href="/black-javascript-guidebook/umi.c1e1dfc3.css"
    />
    <script>
      window.routerBase = "/black-javascript-guidebook/";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>HTTP2 - JavaScript Guidebook</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/computer-networks/http/http2" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/black-javascript-guidebook//">JavaScript Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/black-javascript-guidebook//basic-concept">基本语法</a></span><span><a href="/black-javascript-guidebook//standard-built-in-objects">内置对象</a></span><span><a href="/black-javascript-guidebook//core-modules">核心模块</a></span><span><a href="/black-javascript-guidebook//object-oriented-programming">OOP</a></span><span><a href="/black-javascript-guidebook//browser-object-model">BOM</a></span><span><a href="/black-javascript-guidebook//document-object-model">DOM</a></span><span><a aria-current="page" class="active" href="/black-javascript-guidebook//computer-networks">计算机网络</a></span><span><a href="/black-javascript-guidebook//design-patterns">设计模式</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/yyt520/black-javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/black-javascript-guidebook//"></a><h1>JavaScript Guidebook</h1><p>JavaScript 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/black-javascript-guidebook//basic-concept">基本语法</a></li><li><a href="/black-javascript-guidebook//standard-built-in-objects">内置对象</a></li><li><a href="/black-javascript-guidebook//core-modules">核心模块</a></li><li><a href="/black-javascript-guidebook//object-oriented-programming">OOP</a></li><li><a href="/black-javascript-guidebook//browser-object-model">BOM</a></li><li><a href="/black-javascript-guidebook//document-object-model">DOM</a></li><li><a aria-current="page" class="active" href="/black-javascript-guidebook//computer-networks">计算机网络</a></li><li><a href="/black-javascript-guidebook//design-patterns">设计模式</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/yyt520/black-javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/black-javascript-guidebook//computer-networks">计算机网络</a></li><li><a target="_blank" rel="noopener noreferrer">计算机网络体系</a><ul><li><a href="/black-javascript-guidebook//computer-networks/computer-network-architecture/computer-networks"><span>计算机网络体系</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/computer-network-architecture/transport-layer-protocol"><span>传输层协议</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/computer-network-architecture/network-layer-and-data-link-layer-protocol"><span>网络层与数据链路层协议</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/computer-network-architecture/dns"><span>DNS 域名解析系统</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/computer-network-architecture/cdn"><span>CDN 内容分发网络</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">HTTP</a><ul><li><a href="/black-javascript-guidebook//computer-networks/http/http"><span>HTTP</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/http/http-resource-and-uris"><span>HTTP 资源标识</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/http/http-message"><span>HTTP 报文格式</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/http/http-headers"><span>HTTP 首部字段</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/http/http-status-code"><span>HTTP 状态码</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/http/http-connection"><span>HTTP 连接</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/http/http-content-negotiation"><span>HTTP 内容协商</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/http/cross-origin-resource-sharing"><span>HTTP CORS 跨域资源共享</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/http/content-security-policy"><span>HTTP CSP 内容安全策略</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/http/https"><span>HTTPS</span></a></li><li><a aria-current="page" class="active" href="/black-javascript-guidebook//computer-networks/http/http2"><span>HTTP2</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/http/http3"><span>HTTP3</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">Web 安全</a><ul><li><a href="/black-javascript-guidebook//computer-networks/web-security/same-origin-policy"><span>同源策略</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/web-security/xss"><span>XSS 跨站脚本攻击</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/web-security/csrf"><span>CSRF 跨站请求伪造攻击</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/web-security/ddos"><span>DDoS 攻击</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/web-security/sql-injection"><span>SQL 注入攻击</span></a></li><li><a href="/black-javascript-guidebook//computer-networks/web-security/hijacking"><span>流量劫持</span></a></li></ul></li><li><a href="/black-javascript-guidebook//computer-networks/computer-network-architecture">计算机网络体系</a><ul><li><a href="/black-javascript-guidebook//computer-networks/computer-network-architecture/hls"><span>HLS 流媒体网络传输协议</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="旧版本问题" data-depth="2"><a href="/black-javascript-guidebook//computer-networks/http/http2#旧版本问题"><span>旧版本问题</span></a></li><li title="新特性" data-depth="2"><a href="/black-javascript-guidebook//computer-networks/http/http2#新特性"><span>新特性</span></a></li><li title="二进制分帧" data-depth="3"><a href="/black-javascript-guidebook//computer-networks/http/http2#二进制分帧"><span>二进制分帧</span></a></li><li title="标头压缩" data-depth="3"><a href="/black-javascript-guidebook//computer-networks/http/http2#标头压缩"><span>标头压缩</span></a></li><li title="多路复用" data-depth="3"><a href="/black-javascript-guidebook//computer-networks/http/http2#多路复用"><span>多路复用</span></a></li><li title="服务器推送" data-depth="3"><a href="/black-javascript-guidebook//computer-networks/http/http2#服务器推送"><span>服务器推送</span></a></li><li title="安全提升" data-depth="3"><a href="/black-javascript-guidebook//computer-networks/http/http2#安全提升"><span>安全提升</span></a></li><li title="参考资料" data-depth="2"><a href="/black-javascript-guidebook//computer-networks/http/http2#参考资料"><span>参考资料</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="http2"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#http2"><span class="icon icon-link"></span></a>HTTP2</h1><p>HTTP/2（超文本传输协议第 2 版，最初命名为 HTTP 2.0），简称为 h2（基于 TLS/1.2 或以上版本的加密连接）或 h2c（非加密连接），是 HTTP 协议的的第二个主要版本，使用于万维网。</p><h2 id="旧版本问题"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#旧版本问题"><span class="icon icon-link"></span></a>旧版本问题</h2><ol><li><strong>多个 TCP 连接</strong>：虽然 HTTP/1.1 管线化可以支持请求并发，但是浏览器很难实现，主流浏览器厂商都禁用了管线化</li><li><strong>队头阻塞</strong>：TCP 连接上只能发送一个请求，由于单连接上的串行请求，前面的请求未完成前，后续的请求都在排队等待</li><li><strong>头部冗余</strong>：HTTP/1.x 采用文本格式传输，首部未压缩，无状态特性让每个请求都会带上 Cookie、User-Agent 等重复的信息</li><li><strong>不支持服务端主动推送</strong>：HTTP/1.1 不支持服务推送消息，只能使用轮询的方式解决</li></ol><h2 id="新特性"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#新特性"><span class="icon icon-link"></span></a>新特性</h2><p>在了解 HTTP/2 新特性前，可以通过 DEMO 直观感受 HTTP/1.1 与 HTTP/2 的差距：</p><p><a target="_blank" rel="noopener noreferrer" href="https://http2.akamai.com/demo">HTTP/2: the Future of the Internet | Akamai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>主要新特性：</p><ul><li><strong>传输数据量大量减少</strong><ul><li><a href="/black-javascript-guidebook//computer-networks/http/http2#%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%88%86%E5%B8%A7">二进制分帧</a></li><li><a href="/black-javascript-guidebook//computer-networks/http/http2#%E6%A0%87%E5%A4%B4%E5%8E%8B%E7%BC%A9">标头压缩</a></li></ul></li><li><strong>多路复用及相关功能</strong><ul><li><a href="/black-javascript-guidebook//computer-networks/http/http2#%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8">多路复用</a></li><li>优先级与依赖性</li></ul></li><li><strong>服务器消息推送</strong><ul><li><a target="_blank" rel="noopener noreferrer" href="">服务器推送</a></li></ul></li><li>其他<ul><li>重置流</li><li>流量控制</li><li>HTTPS RFC 规范并没有要求 HTTP2 强制使用 TLS，但是目前世界所有浏览器和- 服务器实现都基于 HTTPS 来实现 HTTP2</li></ul></li></ul><h3 id="二进制分帧"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#二进制分帧"><span class="icon icon-link"></span></a>二进制分帧</h3><p>相比于 HTTP/1.x 基于以换行符作为纯文本的分隔符的解析，HTTP/2 将所有的传输信息分割为更小的消息和帧，并对它们采用 <strong>二进制格式编码</strong>。基于二进制可以使协议有更多的扩展性，例如，引入帧来传输数据和指令。</p><p>HTTP/2 所有性能增强的核心在于新的 <strong style="color:red">二进制分帧层</strong>，它定义了如何封装 HTTP 消息并在客户端与服务器之间传输。</p><blockquote><p>这里所谓的 <strong style="color:red">层</strong>，指的是位于套接字接口与应用可见的高级 HTTP API 之间一个经过优化的新编码机制：HTTP 的语义（包括各种动词、方法、标头）都不受影响，不同的是传输期间对它们的编码方式变了。</p></blockquote><h4 id="数据流消息和帧"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#数据流消息和帧"><span class="icon icon-link"></span></a>数据流、消息和帧</h4><p>新的二进制分帧机制改变了客户端与服务器之间交换数据的方式。</p><p>为了说明这个过程，我们需要了解 HTTP/2 的三个概念：</p><ul><li><strong>数据流</strong>（Stream）：已建立的连接内的 <u>双向字节流</u>，可以承载一条或多条消息</li><li><strong>消息</strong>（Message）：与逻辑请求或响应消息对应的完整的一系列帧</li><li><strong>帧</strong>（Frame）：HTTP/2 通信的最小单位，每个帧都包含帧头，至少也会标识出当前帧所属的数据流</li></ul><p>这些概念的关系总结如下：</p><ul><li>所有通信都在一个 TCP 连接上完成，此连接 <strong>可以承载任意数量的双向数据流</strong></li><li>每个数据流都有一个 <strong>唯一的标识符和可选的优先级信息</strong>，用于承载双向消息</li><li>每条消息都是一条逻辑 HTTP 消息（例如请求或响应），包含一个或多个帧</li><li>帧是最小的通信单位，承载着特定类型的数据，例如 HTTP 标头、消息负载等等。来自不同数据流的帧可以交错发送，然后根据每个帧头的数据流标识符重新组装。</li></ul><p>HTTP/2 将 HTTP 协议通信分解为二进制编码帧的交换，这些帧对应着特定数据流中的消息。所有这些都在一个 TCP 连接内复用，这是 HTTP/2 协议所有其他功能和性能优化的基础。</p></div><img alt="HTTP 数据流通信连接" src="/black-javascript-guidebook/static/connection.71005fe7.svg" width="640"/><div class="markdown"><p><strong>消息的组成：HEADERS 帧与 DATA 帧</strong></p><ul><li>HEADERS frame 头部帧</li><li>DATA frame 数据帧</li></ul></div><img alt="消息组成" src="/black-javascript-guidebook/static/binary-framing.d32ae293.png" width="640"/><div class="markdown"><p>更多关于帧定义详解，请查阅 <a target="_blank" rel="noopener noreferrer" href="https://halfrost.com/http2-http-frames-definitions/">HTTP/2 中的帧定义<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h3 id="标头压缩"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#标头压缩"><span class="icon icon-link"></span></a>标头压缩</h3><p>标头压缩（Header compression）：每个 HTTP 传输都承载一组标头，这些标头说明了传输的资源及其属性。 在 HTTP/1.x 中，此元数据始终以纯文本形式，通常会给每个传输增加 500–800 字节的开销。如果使用 HTTP Cookie，增加的开销有时会达到上千字节。</p><p>为了减少此开销和提升性能，HTTP/2 使用 <strong style="color:red">HPACK</strong> 压缩格式压缩请求和响应标头元数据，这种格式采用两种简单但是强大的技术：</p><ol><li>这种格式支持通过静态霍夫曼代码对传输的标头字段进行编码，从而减小了各个传输的大小。</li><li>这种格式要求通讯双方 <strong>各自缓存一份头域索引表</strong>，相同的消息头只发送 <strong>索引号</strong>（换句话说，它可以建立一个共享的压缩上下文），此索引表随后会用作参考，对之前传输的值进行有效编码。</li></ol><p>利用霍夫曼编码（HPACK），可以在传输时对各个值进行压缩，而利用之前传输值的索引列表，我们可以通过传输索引值的方式对重复值进行编码，索引值可用于有效查询和重构完整的标头键值对。</p><p><strong>索引表用法示意</strong></p></div><img alt="索引表用法示意" src="/black-javascript-guidebook/static/headers-compress.d86438ec.jpg" width="520"/><div class="markdown"><p>客户端发了两次请求，第一次请求有完整的 HTTP 报文头部，第二次请求的时候只有一个 <code>path</code> 的字段不一样，但是这次报文头它只需要发送一个 <code>path</code> 的字段就好了，这样就大大减少了发送的量。这个的实现要求客户端和服务同时维护一个报文头表。</p><h4 id="hpack-霍夫曼编码"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#hpack-霍夫曼编码"><span class="icon icon-link"></span></a>HPACK 霍夫曼编码</h4><p>HPACK 压缩示意：</p></div><img alt="HPACK压缩示意" src="/black-javascript-guidebook/static/hpack-header-compression.d81fd72c.png" width="640"/><div class="markdown"><p>作为一种进一步优化方式，HPACK 压缩上下文包含一个静态字典和一个动态字典：</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://httpwg.org/specs/rfc7541.html#static.table.definition">静态字典<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 在规范中定义，并提供了一个包含所有连接都可能使用的常用 HTTP 标头字段（例如，有效标头名称）的列表</li><li>动态字典最初为空，将根据在特定连接内交换的值进行更新</li></ul><p>因此，为之前未见过的值采用静态 Huffman 编码，并替换每一侧静态表或动态表中已存在值的索引，可以减小每个请求的大小。</p><blockquote><p>⚠️ <strong>注意</strong>：在 HTTP/2 中，请求和响应标头字段的定义保持不变，仅有一些微小的差异：所有标头字段名称均为小写，请求行现在拆分成各个 <code>:method</code>、<code>:scheme</code>、<code>:authority</code> 和 <code>:path</code> 伪标头字段。</p></blockquote><ul><li>关于 <a target="_blank" rel="noopener noreferrer" href="https://tools.ietf.org/html/rfc7541">HPACK 头部压缩标准<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的制定</li><li><a target="_blank" rel="noopener noreferrer" href="https://httpwg.org/specs/rfc7541.html">HPACK：Header Compression for HTTP/2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h3 id="多路复用"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#多路复用"><span class="icon icon-link"></span></a>多路复用</h3><p><strong>多路复用（MultiPlexing）</strong>：通过该功能，在一条连接上，您的浏览器可以同时发起无数个请求，并且响应可以同时响应。另外，多路复用中支持了流的优先级（Stream dependencies）设置，允许客户端告知服务器最优资源，可以优先传输。</p><p>当我们打开网站时，浏览器会对每个网页并发的连接进行限制，一般浏览器的 HTTP 请求并发数限制在 6-8 个。但实际上，绝大部分网站首页所需要的资源个数远大于这个限制。所以为了不让资源在下载阶段就被阻塞住，我们往往会把一些静态资源分散到 CDN 或其他服务器上，从而通过多域名的方式突破浏览器对并发连接数的限制，从而使得网站能同时下载尽可能多的资源。</p><p>但建立更多的连接也意味更多的开销。每个 HTTP 请求都对应建立 TCP 连接，也许有些资源体积只有几 kb，这些情况下建立连接本身的开销就变得更客观，很可能三次握手的实践比传输时间还长</p><p>在 HTTP/2 中，有了二进制分帧之后，HTTP/2 不再依赖 TCP 链接去实现多流并行，而是通过 <strong style="color:red">流</strong> 支持多路复用。</p><p>将 HTTP 消息分解为独立的帧，交错发送，然后在另一端重新组装是 HTTP/2 最重要的一项增强。事实上，这个机制会在整个网络技术栈中引发一系列连锁反应，从而带来巨大的性能提升，让我们可以：</p><ul><li>并行交错地发送多个请求/响应，请求/响应之间互不影响</li><li>不必再为绕过 HTTP/1.x 限制而做很多工作（请参阅 <a target="_blank" rel="noopener noreferrer" href="https://hpbn.co/optimizing-application-delivery/#optimizing-for-http1x">针对 HTTP/1.x 进行优化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，例如级联文件、Image Sprites 和域名分片</li><li>消除不必要的延迟和提高现有网络容量的利用率，从而减少页面加载时间</li></ul><p>HTTP/2 中的新二进制分帧层解决了 HTTP/1.x 中存在的 <strong>队头阻塞</strong> 问题，也消除了并行处理和发送请求及响应时对多个连接的依赖。</p><h3 id="服务器推送"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#服务器推送"><span class="icon icon-link"></span></a>服务器推送</h3><p>服务端推送（Server push）：同 SPDY 一样，HTTP/2 也具有客户端推送功能。目前，大多数网站已经启用 HTTP/2，如淘宝。使用服务器推动，可以提前将资源推送至浏览器缓存。</p><p>HTTP/2 中的 Server Push 并不是指类似于现在的 Server Sent Event（SSE） 或者 WebSocket 的推送技术。<strong>它是一种服务器根据客户端以前发送的请求来猜测未来的请求，并提前将未来请求的结果推送给客户端的技术</strong>。</p></div><img alt="服务器推送" src="/black-javascript-guidebook/static/server-push.baa73ef9.png" width="640"/><div class="markdown"><blockquote><p>为什么在浏览器中需要一种此类机制呢？</p></blockquote><p>一个典型的网络应用包含多种资源，客户端需要检查服务器提供的文档才能逐个找到它们。 那为什么不让服务器提前推送这些资源，从而减少额外的延迟时间呢？ 服务器已经知道客户端下一步要请求什么资源，这时候服务器推送即可派上用场。</p><p>事实上，如果您在网页中内联过 CSS、JavaScript，或者通过数据 URI 内联过其他资产（请参阅 <a target="_blank" rel="noopener noreferrer" href="https://hpbn.co/http1x/#resource-inlining">资源内联<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），那么您就已经亲身体验过服务器推送了。 对于将资源手动内联到文档中的过程，我们实际上是在将资源推送给客户端，而不是等待客户端请求。 使用 HTTP/2，我们不仅可以实现相同结果，还会获得其他性能优势。</p><p>推送资源可以进行以下处理：</p><ul><li>由客户端缓存</li><li>在不同页面之间重用</li><li>与其他资源一起复用</li><li>由服务器设定优先级</li><li>被客户端拒绝</li></ul><h4 id="nginx-配置实现"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#nginx-配置实现"><span class="icon icon-link"></span></a>Nginx 配置实现</h4><p>通过 Nginx 配置能主动推送两个 HTML 文档中需要请求的文件：</p><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token directive keyword">server</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment"># 设定开启使用 HTTP2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">listen</span><span class="token directive"> </span><span class="token directive number">443</span><span class="token directive"> ssl http2</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">server_name</span><span class="token directive">  localhost</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">ssl</span><span class="token directive">                      </span><span class="token directive boolean">on</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">ssl_certificate</span><span class="token directive">          /etc/nginx/certs/example.crt</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">ssl_certificate_key</span><span class="token directive">      /etc/nginx/certs/example.key</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">ssl_session_timeout</span><span class="token directive">  </span><span class="token directive number">5m</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">ssl_ciphers</span><span class="token directive"> HIGH:!aNULL:!MD5</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">ssl_protocols</span><span class="token directive"> SSLv3 TLSv1 TLSv1.1 TLSv1.2</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">ssl_prefer_server_ciphers</span><span class="token directive">   </span><span class="token directive boolean">on</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">location</span><span class="token directive"> /</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token directive keyword">root</span><span class="token directive">   /usr/share/nginx/html</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token directive keyword">index</span><span class="token directive">  index.html index.htm</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">      </span><span class="token comment"># 服务器主动推送这两个文件</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token directive keyword">http2_push</span><span class="token directive"> /style.css</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token directive keyword">http2_push</span><span class="token directive"> /example.png</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span></div></pre></div><p>这种方式需要写在服务器配置中，每次修改都要重启服务，而且应用与服务器的配置不应该混在一起。</p><h4 id="服务端实现"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#服务端实现"><span class="icon icon-link"></span></a>服务端实现</h4><p>服务器推送还有另一个实现方法，就是后端应用产生 HTTP 响应头信息 <code>Link</code> 命令。服务器发现有这个头信息，就会进行服务器推送。</p><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token header header-name keyword">Link</span><span class="token header punctuation">:</span><span class="token header"> </span><span class="token header header-value">&lt;/styles.css&gt;; rel=preload; as=style</span></div></pre></div><p>如果要推送多个资源：</p><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token header header-name keyword">Link</span><span class="token header punctuation">:</span><span class="token header"> </span><span class="token header header-value">&lt;/styles.css&gt;; rel=preload; as=style, &lt;/example.png&gt;; rel=preload; as=image</span></div></pre></div><p>这时，Nginx 的配置改成下面这样。</p><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token directive keyword">server</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">listen</span><span class="token directive"> </span><span class="token directive number">443</span><span class="token directive"> ssl http2</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment"># ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">root</span><span class="token directive"> /var/www/html</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">location</span><span class="token directive"> = /</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token directive keyword">proxy_pass</span><span class="token directive"> http://upstream</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token directive keyword">http2_push_preload</span><span class="token directive"> </span><span class="token directive boolean">on</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>如果服务器或者浏览器不支持 HTTP2，那么浏览器就会按照 <code>preload</code> 来处理这个头信息，预加载指定的资源文件。</p><p>事实上，这个头信息就是 <code>preload</code> 标准提出的，它的语法和 <code>as</code> 属性的值都写在了 <a target="_blank" rel="noopener noreferrer" href="https://w3c.github.io/preload/#as-attribute">标准<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 里面。</p><p>参考 <a target="_blank" rel="noopener noreferrer" href="https://blog.risingstack.com/node-js-http-2-push/">HTTP/2 Server Push with Node.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实现。</p><h4 id="缓存问题"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#缓存问题"><span class="icon icon-link"></span></a>缓存问题</h4><p>服务器推送有一个很麻烦的问题。所要推送的资源文件，如果浏览器已经有缓存，推送就是浪费带宽。即使推送的文件版本更新，浏览器也会优先使用本地缓存。</p><p>一种解决办法是，只对第一次访问的用户开启服务器推送。下面是 Nginx 官方给出的示例，根据 Cookie 判断是否为第一次访问。</p><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token directive keyword">server</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">listen</span><span class="token directive"> </span><span class="token directive number">443</span><span class="token directive"> ssl http2 default_server</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">ssl_certificate</span><span class="token directive"> ssl/certificate.pem</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">ssl_certificate_key</span><span class="token directive"> ssl/key.pem</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">root</span><span class="token directive"> /var/www/html</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">http2_push_preload</span><span class="token directive"> </span><span class="token directive boolean">on</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">location</span><span class="token directive"> = /demo.html</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token directive keyword">add_header</span><span class="token directive"> Set-Cookie </span><span class="token directive string">&quot;session=1&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token directive keyword">add_header</span><span class="token directive"> Link </span><span class="token directive variable">$resources</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token directive keyword">map</span><span class="token directive"> </span><span class="token directive variable">$http_cookie</span><span class="token directive"> </span><span class="token directive variable">$resources</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    &quot;~*session=1&quot; &quot;&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token directive keyword">default</span><span class="token directive"> </span><span class="token directive string">&quot;&lt;/style.css&gt;; as=style; rel=preload&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><h3 id="安全提升"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#安全提升"><span class="icon icon-link"></span></a>安全提升</h3><blockquote><p>HTTP/2 是不是必须基于 TLS/SSL 协议？</p></blockquote><ul><li>IETF 标准不要求必须基于 TLS/SSL 协议 📌</li><li>浏览器要求必须基于 TLS/SSL 协议 📌</li><li>在 TLS 层 ALPN（Application Layer Protocol Negotiation）扩展做协商，只认 HTTP/1.x 的代理服务器不会干扰 HTTP/2</li><li>sheme：<code>http://</code> 和 <code>https://</code> 默认基于 80 和 443 端口</li><li>h2：基于 TLS 协议运行的 HTTP/2 被称为 <code>h2</code></li><li>h2c：基于 TCP 协议之上运行的 HTTP/2 被称为 <code>h2c</code></li></ul><h2 id="参考资料"><a aria-hidden="true" tabindex="-1" href="/black-javascript-guidebook//computer-networks/http/http2#参考资料"><span class="icon icon-link"></span></a>参考资料</h2><ul><li><a target="_blank" rel="noopener noreferrer" href="https://developers.google.com/web/fundamentals/performance/http2/">📖 Google developers document: Introduction to HTTP/2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://imququ.com/post/http2-resource.html">📖 HTTP2 资料汇总<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://ye11ow.gitbooks.io/http2-explained/content/">📝 HTTP2 讲解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://segmentfault.com/a/1190000007219256">📝 深入研究：HTTP2 的真正性能到底如何<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/29609078">📝 怎样把网站升级到 HTTP/2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.im/post/5c5ada2e6fb9a049dd80be75">📝 HTTP/2 常见问题解答<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.im/post/5c6a9f85e51d4503831ad4fa">📝 从理论到实践，全面理解 HTTP/2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.im/post/5c4e6d11e51d4534dc477f05">📝 再谈 HTTP2 性能提升之背后原理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.ruanyifeng.com/blog/2018/03/http2_server_push.html">📝 阮一峰：HTTP/2 服务器推送（Server Push）教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://chrome.google.com/webstore/detail/http2-and-spdy-indicator/mpbpobfflnpcgagjijhmgnchggcjblin/related?hl=zh-CN">🛠 HTTP/2 and SPDY indicator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/yyt520/black-javascript-guidebook/edit/master/docs/computer-networks/http/http2.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">2023/7/9 15:48:07</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/black-javascript-guidebook/umi.397d416d.js"></script>
  </body>
</html>
